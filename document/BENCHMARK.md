# 压测环境说明
## 硬件配置
```
机器配置：
CPU：20 x Intel(R) Xeon(R) Silver 4114 CPU @ 2.20GHz  
内存：192 GB  
硬盘：ssd  
网卡：万兆网卡  
服务端集群机器个数：3台
压测机器个数：1台
```

## 集群环境
- wlock：三个节点
- redisson：一主节点，两从节点
- redLock：三主节点
- zookeeper：三个节点
- etcd：三个节点
## 对比产品版本
| 产品  |  版本 |
| ------------ | ------------ |
| redisson  | redisson-3.17.3  redis-6.2.7  |
| redlock  | redisson-3.17.3  redis-6.2.7  |
| zookeeper  | zookeeper-3.4.9  curator-2.13.0  |
| etcd  | etcd-v3.2.1  jetcd-0.0.2  |
| wlock  | 1.0.0  |


# 压测结果

## 不同线程下，分布式锁的吞吐量QPS
条件：单客户端，单进程，获取锁+释放锁算一次qps，无竞争

|  对比产品 | 线程数  | QPS  | RT(mean)ms  | RT(P99)ms  | 错误率  |
| ------------ | ------------ | ------------ | ------------ | ------------ | ------------ |
|  wlock |  5 | 6678  | 0.747  | 1.983  |  0 |
| wlock  | 10  | 12041  | 0.828  | 1.985  | 0  |
|  wlock | 15  |  16008 | 0.935  | 2.129  | 0  |
| wlock  | 20  | 19846  | 1.006  | 2.269  | 0  |
| wlock  | 40  | 32582  | 1.226  | 2.599  | 0  |
|  wlock | 80  | 50274  | 1.589  | 4.210  |  0 |
|  wlock | 120  | 55955  |  2.142 |  5.783 | 0  |
|  wlock | 200  | 58036  | 3.444  | 9.507  | 0  |
| wlock  |  240 |  58726 | 4.284  |  29.257 | 0  |
| wlock  |  280| 58134  | 4.815  | 37.366  |  0 |
|  wlock | 320  |  56460 | 5.666  | 39.805  | 0  |
|  redission | 5  | 22280  | 0.223  | 0.289  | 0  |
|  redission |  10 | 28792  |  0.345 | 0.442  | 0  |
| redission  | 15  | 30198  |  0.495 |  0.528 | 0  |
| redission  | 20  | 29738  | 0.671  |  0.709 |  0 |
| redission  |  40 | 30437  | 1.312  | 1.383  |  0 |
|  redission |  80 | 30560  |  2.616 | 3.148  |  0 |
|redission   | 120  | 30734  | 3.903  | 4.650  | 0  |
|  redission |  200 | 29959  | 6.674  | 10.796  | 0  |
|redission   | 240  | 29644  | 8.094 | 12.683  |  0 |
| redission  | 280  |  30028 |  9.323 |  14.283 | 0  |
|  redission | 320  | 29654  | 10.789  | 15.334  | 0  |
| redLock  | 5  | 7825  | 0.637  | 0.742  |  0 |
|  redLock | 10  | 13839  | 0.721  | 0.893  | 0  |
| redLock  | 15  | 18615  | 0.804  | 0.977  | 0  |
| redLock  |  20 | 22544  |  0.885 | 1.057  | 0  |
| redLock  | 40  | 28460  |  1.404 | 1.645  | 0  |
| redLock  | 80  | 29381  | 2.721  | 3.290  | 0  |
|  redLock | 120  | 29719  | 4.036  |5.368   | 0  |
| redLock  | 200  | 29788  | 6.712  | 13.387  | 0  |
| redLock  | 240  | 29472  | 8.141  | 15.203  | 0  |
| redLock  | 280  | 29520  | 9.483  |  16.902 | 0  |
| redLock  | 320  | 29081  | 11.002  | 18.955  | 0 |
|  zookeeper | 5  | 2301  | 2.170  | 2.223  | 0 |
| zookeeper  | 10  | 3793  | 2.634  | 3.120  | 0 |
| zookeeper  | 15  |  4789 | 3.130  | 3.514  |0  |
| zookeeper  | 20  | 5731  | 3.218  | 3.868  | 0 |
| zookeeper  | 40  | 6434  | 6.214  | 7.161  | 0 |
|  zookeeper | 80  | 6655  | 12.018  | 12.932  |0  |
| etcd  |  5 | 1834  | 2.724  |  5.325 | 0 |
|  etcd | 10  | 2919  |  3.423 | 11.276 | 0 |
|  etcd | 15  | 3743  | 4.005  | 16.249  |0  |
| etcd  |  20 | 4243  | 4.711  | 20.763  |0  |
| etcd  | 40  | 5445  | 7.344  | 35.085  | 0 |

### 对比效果图
<img src="img/qps.png" height="60%" width="60%" />

### 相同并发下，平均响应时间ms

<img src="img/rt.png" height="60%" width="60%" />

## 在锁竞争场景下的处理能力

条件：单客户端，单进程，压测时长10min，获取锁+释放锁操作算一次qps

| 产品  | 获取锁后等待时间  |   线程数|  lockKey数量 |  qps |
| ------------ | ------------ | ------------ | ------------ | ------------ |
| wlock  | 0ms  |   1500| 15  | 16437  |
|  wlock |  50ms |   1500|   15  | 291|
|  redisson |  0ms | 1500  |  15| 17889  |
| redisson  | 50ms  |  1500 |  15 | 298 |

## 服务端最大的吞吐量
条件：多进程，多压测机，多客户端，每个进程开启40线程，压测时长10min，获取锁+释放锁操作算一次qps

|  产品 |  最大吞吐量 |
| ------------ | ------------ |
|  wlock |  13.6万 |
|  redisson | 3.0万  |
| zookeeper  | 8750  |
|  etcd | 6793  |

